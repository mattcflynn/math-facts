<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Practice</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #question, #feedback, #summary {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Multiplication Practice</h1>
    <p id="instruction">Enter a number to practice, or "*+*" to quit:</p>
    
    <!-- Changed type to "number" for numeric input -->
    <input type="number" id="numInput" placeholder="Number to practice">
    <button onclick="startPractice()">Start Practice</button>

    <div id="question"></div>
    
    <!-- Changed type to "number" for numeric input -->
    <input type="number" id="answerInput" style="display:none;" placeholder="Your answer">
    <button id="submitAnswerBtn" style="display:none;" onclick="submitAnswer()">Submit Answer</button>

    <p id="feedback"></p>
    <p id="summary"></p>

    <script>
        let wrong = [];
        let numToPractice = 0;
        let numList = [];
        let currentTest = 0;
        let correctAnswers = 0;
        let initialMissed = 0;
        let lastMessage = ""; // Track the last feedback message
        const correctMessages = ["Good job!", "Right!", "Yep!", "Nailed it.", "Spot on!", "Bingo!", "Crushed it.", "Totally!", "Perfecto!", "You are killing it.", "Genius!", "Fantastic!", "You rock!", "Awesome!", "Niiiiiiiice!", "Yaaaasssss!", "So. Dang. Smart."];
        const incorrectMessages = ["Nope", "Sorry, that's not it", "Maybe next time", "No. Focus!", "Hmmm, no.", "Uuuuuuh, no.", "Ew, no!.", "Nasty! No way."];

        // Set focus on the input when the page loads
        window.onload = function() {
            document.getElementById("numInput").focus();
        };

        // Start practice function
        function startPractice() {
            const input = document.getElementById("numInput").value;
            document.getElementById("feedback").textContent = ""; // Clear feedback
            document.getElementById("summary").textContent = ""; // Clear summary

            if (input === "*+*") {
                return;
            }

            const intIn = parseInt(input);
            if (isNaN(intIn)) {
                document.getElementById("feedback").textContent = "Please enter a valid number.";
                return;
            }

            numToPractice = intIn;
            numList = Array.from({length: 12}, (_, i) => i + 1); // list from 1 to 12
            correctAnswers = 0;
            initialMissed = 0;
            wrong = [];

            document.getElementById("answerInput").style.display = "inline";
            document.getElementById("submitAnswerBtn").style.display = "inline";
            document.getElementById("answerInput").focus(); // Focus the input field after the practice starts
            askQuestion();
        }

        // Ask the next question
        function askQuestion() {
            if (numList.length > 0) {
                const randomIndex = Math.floor(Math.random() * numList.length);
                currentTest = numList.splice(randomIndex, 1)[0]; // Get random number from list
                document.getElementById("question").textContent = `What is ${currentTest} x ${numToPractice}?`;
                document.getElementById("answerInput").focus(); // Ensure the cursor is in the answer input field
            } else if (wrong.length > 0) {
                currentTest = wrong.pop();
                document.getElementById("question").textContent = `Retry: What is ${currentTest} x ${numToPractice}?`;
                document.getElementById("answerInput").focus();
            } else {
                endPractice();
            }
        }

        // Handle submission of answers
        function submitAnswer() {
            const answer = parseInt(document.getElementById("answerInput").value);

            if (isNaN(answer)) {
                document.getElementById("feedback").textContent = "Please enter a valid number.";
                return;
            }

            if (answer === currentTest * numToPractice) {
                const message = randomMessage(correctMessages);
                document.getElementById("feedback").textContent = message;
                lastMessage = message;
                correctAnswers++;
            } else {
                const message = randomMessage(incorrectMessages);
                document.getElementById("feedback").textContent = message;
                lastMessage = message;
                wrong.push(currentTest);
                if (numList.length > 0) initialMissed++; // Only count initial missed
            }

            document.getElementById("answerInput").value = ""; // Clear input for next question
            askQuestion();
        }

        // Get random message ensuring it's not repeated
        function randomMessage(arr) {
            let message;
            do {
                message = arr[Math.floor(Math.random() * arr.length)];
            } while (message === lastMessage); // Prevent repeating the same message twice in a row
            return message;
        }

        // End practice session and show summary
        function endPractice() {
            document.getElementById("question").textContent = "";
            document.getElementById("answerInput").style.display = "none";
            document.getElementById("submitAnswerBtn").style.display = "none";

            if (initialMissed === 0) {
                document.getElementById("summary").textContent = `Wow, 100%! You got them all right on the first try!`;
            } else {
                document.getElementById("summary").textContent = `You got them all! This time you missed ${initialMissed}.`;
            }
        }

        // Allow the "Enter" key to start practice
        document.getElementById("numInput").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                startPractice();
            }
        });

        // Allow the "Enter" key to submit the answer
        document.getElementById("answerInput").addEventListener("keyup", function(event) {
            if (event.key === "Enter") {
                submitAnswer();
            }
        });
    </script>
</body>
</html>